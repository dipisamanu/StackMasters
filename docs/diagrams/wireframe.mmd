graph TD
    %% --- CONFIGURAZIONE STILI AVANZATA ---
    %% Curve morbide per i collegamenti
    linkStyle default interpolate basis stroke:#455a64,stroke-width:2px;

    %% Palette Colori "Material Design"
    %% Public: Blue
    classDef public fill:#bbdefb,stroke:#1565c0,stroke-width:2px,rx:10,ry:10,color:#0d47a1;
    %% User: Green
    classDef user fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px,rx:10,ry:10,color:#1b5e20;
    %% Staff: Orange
    classDef staff fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px,rx:10,ry:10,color:#e65100;
    %% Admin: Purple
    classDef admin fill:#e1bee7,stroke:#6a1b9a,stroke-width:2px,rx:10,ry:10,color:#4a148c;
    %% Action: Grey/White
    classDef action fill:#f5f5f5,stroke:#616161,stroke-width:1px,stroke-dasharray: 5 5,rx:5,ry:5,color:#212121;

    %% --- HEADER GLOBALE ---
    HEADER("<b>üèõÔ∏è HEADER / NAVIGAZIONE</b><br/>- Logo & Search Bar (AJAX)<br/>- Link: Catalogo, Login, Registrati<br/>- Widget: Novit√†, Trending"):::public

    %% --- FLUSSO PRINCIPALE ---
    HEADER --> CATALOGO
    HEADER --> LOGIN
    HEADER --> REGISTRAZIONE

    %% --- SOTTOGRAFO: AREA PUBBLICA ---
    subgraph PUBLIC [üåê Area Pubblica]
        direction TB
        style PUBLIC fill:#ffffff,stroke:#bbdefb,stroke-width:2px,rx:10,ry:10
        
        CATALOGO["<b>üîé CATALOGO</b><br/>- Ricerca Avanzata<br/>- Filtri (Anno, Genere)<br/>- Griglia Libri<br/>- Paginazione"]:::public
        
        SCHEDA_LIBRO["<b>üìñ SCHEDA LIBRO</b><br/>- Dettagli & Copertina<br/>- Stato (Disp/Prestito)<br/>- Tasto: Prenota<br/>- Recensioni & Consigliati"]:::public
        
        CATALOGO -->|Click Card| SCHEDA_LIBRO
        SCHEDA_LIBRO -->|Vedi Simili| SCHEDA_LIBRO
    end

    %% --- SOTTOGRAFO: AUTENTICAZIONE ---
    subgraph AUTH [üîê Autenticazione]
        direction TB
        style AUTH fill:#ffffff,stroke:#cfd8dc,stroke-width:2px,rx:10,ry:10

        LOGIN["<b>üë§ LOGIN</b><br/>- Form Credenziali<br/>- Recupero Password"]:::public
        
        REGISTRAZIONE["<b>üìù REGISTRAZIONE</b><br/>- Dati Anagrafici<br/>- Calcolo CF (Auto)<br/>- Consenso Privacy"]:::public
        
        EMAIL_VERIFICA(Sistema: Invia Email Verifica):::action
        
        LOGIN <--> REGISTRAZIONE
        REGISTRAZIONE -.-> EMAIL_VERIFICA -.-> LOGIN
    end

    %% --- DIRAMAZIONE RUOLI ---
    LOGIN ==>|Studenti/Docenti| DASH_USER
    LOGIN ==>|Bibliotecario| DASH_BIBLIO
    LOGIN ==>|Admin| DASH_ADMIN

    %% --- SOTTOGRAFO: AREA UTENTE ---
    subgraph USER_AREA [üë§ Area Utente]
        direction TB
        style USER_AREA fill:#ffffff,stroke:#c8e6c9,stroke-width:2px,rx:10,ry:10

        DASH_USER["<b>üè† DASHBOARD UTENTE</b><br/>- Prestiti Attivi (+ Rinnova)<br/>- Prenotazioni (+ Countdown)<br/>- Alert Multe"]:::user
        
        GAMIFICATION["<b>üèÜ GAMIFICATION</b><br/>- Badge & Livello<br/>- Classifiche"]:::user
        PROFILO["<b>‚öôÔ∏è PROFILO</b><br/>- Dati Personali<br/>- Storico"]:::user
        
        DASH_USER --> GAMIFICATION
        DASH_USER --> PROFILO
        DASH_USER -.->|Cerca| CATALOGO
    end

    %% --- SOTTOGRAFO: AREA BIBLIOTECARIO ---
    subgraph STAFF_AREA [üìö Area Bibliotecario]
        direction TB
        style STAFF_AREA fill:#ffffff,stroke:#ffe0b2,stroke-width:2px,rx:10,ry:10

        DASH_BIBLIO["<b>üìä DASHBOARD STAFF</b><br/>- KPI Giornalieri<br/>- Scadenze imminenti"]:::staff
        
        OP_PRESTITO["<b>üì§ NUOVO PRESTITO</b><br/>- Scan Utente<br/>- Scan Libro<br/>- Check Blocchi/Multe"]:::staff
        
        OP_RESTITUZIONE["<b>üì• RESTITUZIONE</b><br/>- Scan Rientro<br/>- Check Danni<br/>- Calcolo Multa"]:::staff
        
        OP_CATALOGAZIONE["<b>üè∑Ô∏è CATALOGAZIONE</b><br/>- Scan EAN (API Google)<br/>- Gestione Copie Fisiche<br/>- Stampa Etichette"]:::staff
        
        DASH_BIBLIO --> OP_PRESTITO
        DASH_BIBLIO --> OP_RESTITUZIONE
        DASH_BIBLIO --> OP_CATALOGAZIONE
        DASH_BIBLIO --> USER_MGMT["üë• Gestione Utenti"]:::staff
    end

    %% --- SOTTOGRAFO: AREA AMMINISTRATORE ---
    subgraph ADMIN_AREA [‚öôÔ∏è Area Amministratore]
        style ADMIN_AREA fill:#ffffff,stroke:#e1bee7,stroke-width:2px,rx:10,ry:10

        DASH_ADMIN["<b>üìà DASHBOARD ADMIN</b><br/>- Analytics Avanzati<br/>- Gestione Ruoli<br/>- Export Report PDF/Excel"]:::admin
    end