if exist drop database

nome database biblioteca_db

Autori:
id				        int pk
nome				    varchar(100)
cognome			        varchar(100)
ultimo_aggiornamento 	current_timestamp



Libro
id_libro				int	pk
titolo				    varchar(100)
descrizione			    text
isbn				    varchar(17)		unique
anno_uscita			    datetime
editore				    varchar(100)
lingua_id			    int	fk
lingua_originale_id 		int	fk
numero_pagine		    int
valore_copertina 		decimal(7,2)
rating				    float	function - media voti recensioni
copertina_url			text
ultimo_aggiornamento	current_timestamp

https://www.reddit.com/r/webdev/comments/1cktt26/can_i_trust_google_books_api/



Libro_Autore
id_autore	            int 	pk	fk
id_libro		        int		pk	fk
ultimo_aggiornamento	current_timestamp



Lingua
id				        int		pk
nome   			        varchar(60)
ultimo_aggiornamento	current_timestamp



Genere
id				        int		pk
nome				    varchar(60)
ultimo_aggiornamento	current_timestamp



Libro_Genere
id_genere			    int	pk	fk
id_libro				int	pk	fk
ultimo_aggiornamento	current_timestamp



RFID
id_rfid				    int	pk
rfid				    varchar(128)	unique  alfanumerico + ON DELETE(‘CASCADE’)
tipo  				    varchar(20)	ENUM(‘utente’',’libro’)
ultimo_aggiornamento	current_timestamp



Inventario
id_inventario			int	pk
id_libro				id	fk
id_rfid				    int	unique fk
stato				    varchar(30) ENUM('DISPONIBILE','IN_PRESTITO',’PRENOTATO,’’non in prestito’)
condizione			    ENUM(‘BUONO’,’DANNEGGIATO','PERSO')
collocazione			varchar(20) // cod. biblioteca + scaffale/sezione/ripiano + c. autore (3 char)
ultimo_aggiornamento	current_timestamp



Prestiti
id_prestito			    int	pk
data_prestito   		current_timestamp
scadenza_prestito		timestamp
data_restituzione		NULL
id_inventario			int	fk
id_utente			    int	fk
ultimo_aggiornamento	current_timestamp

funzione - controllo data_ritorno -> 3+ giorni = creazione multa
sistema notifiche da implementare



Utente
id_utente			    int	pk
cf				        char(16)	unique https://www.miocodicefiscale.com/it/api-rest-verifica-e-calcolo-codice-fiscale
username			    varchar(50)
nome				    varchar(100)
cognome			        varchar(100)
email				    varchar(255)
password			    varchar(255)
data_nascita 			datetime
sesso				    varchar(1) / enum(‘M’,’F’)
comune_nascita		    varchar(100)
token				    varchar(32)
email_verificata		bool
scadenza_verifica		current_timestamp + 1h
tentativi_login_falliti	tinyint null
blocco_account_fino_al	current_timestamp + 15min
consenso_privacy		boolean not null default 0
notifiche_attive		boolean
quiet_hours_start   	TIME - es. 22:00
quiet_hours_end     	TIME - es. 08:00
livello_xp          	int  unsigned	- Per gamification
id_rfid				    int	unique fk
data_creazione 		    current_timestamp
ultimo_aggiornamento	current_timestamp



Badge
id_badge			    int	pk
nome				    varchar(50) unique
desc				    text
icona_url 			    text



Utente_Badge
id_utente 			    int	pk fk
id_badge 			    int	pk fk
data_conseguimento 		current_timestamp



Ruolo
id_ruolo 			    int
priorità				tinyint unsigned not null unique comment '0=Admin,1=Bibliotecario,2=Docente,3=Studente'
nome				    varchar(15)
durata_prestito		    tinyint
limite_prestiti			tinyint
ultimo_aggiornamento	current_timestamp



Utente_ruolo
id_utente			    int	pk	fk
id_ruolo			    int	pk	fk
prestiti_tot			int	0
streak_restituzioni		int	0 unsigned	-quando c’è una multa la streak viene ridotta di 20, fino a un minimo di 0


Recensioni
id_recensione			int	pk
id_libro				int	fk
id_utente			    int	fk
voto				    int
descrizione			    text
data_creazione 		    current_timestamp
data_update 			current_timestamp



Prenotazioni
id_prenotazione         int  	pk
id_utente			    int	fk
id_libro              	int	fk
copia_libro        		null fk -> inventario:rfid
data_richiesta			current_timestamp
data_disponibilità		current_timestamp
scadenza_ritiro         timestamp apertura biblioteca + 48h / NULL
ultimo_aggiornamento	current_timestamp



Multe
id_multa			    int	pk
id_utente 			    int	fk
giorni         			int	fk NULL
importo        			decimal(10, 2)	function/manual
causa				    varchar(15)	enum(ritardo, danni)
commento			    text
data_creazione       	current_timestamp
data_pagamento      	NULL
ultimo_aggiornamento	current_timestamp



Log_Audit
id				        int	pk
id_utente 			    int	fk
azione         		    ENUM('LOGIN_FALLITO', 'LOGIN_SUCCESS', 'CREAZIONE_UTENTE', 'MODIFICA_PRESTITO', 'CANCELLAZIONE_LIBRO')
dettagli       		    text (es. "IP: 192.168.1.1, Modificato ruolo utente X")
ip_address 			    int unsigned comment 'IPv4 convertito con INET_ATON'
ipv6 				    varbinary(16) comment 'IPv6 convertito con INET6_ATON',
timestamp			    current_timestamp

